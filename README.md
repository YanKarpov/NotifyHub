# NotifyHub — сервис отправки сообщений

## Архитектура и компоненты

### Backend (Rust + Actix-web + SQLx + Tokio):

- **HTTP API:**
  - `POST /enqueue` — добавить сообщение в очередь на отправку.
  - `GET /messages` — получить список последних сообщений с их статусами.
  - `GET /events` — SSE поток событий об изменениях статусов сообщений.
  - `GET /health` — проверка состояния сервиса.

- **База данных PostgreSQL** (работает в Docker):
  - Таблица `messages` хранит сообщения, их статусы, счетчик попыток и время следующей попытки (для отложенных сообщений).

- **Воркер (`worker_loop`):**
  - Периодически (каждые 5 секунд) выбирает до 10 сообщений со статусом `pending` или `retrying`, которым пора отправляться.
  - Отправляет сообщения через провайдер (реализован `MockProvider`).
  - В случае успеха обновляет статус в БД на `done`.
  - В случае ошибки увеличивает счетчик попыток, обновляет статус на `retrying` и устанавливает `next_retry_at` с экспоненциальной задержкой (2^`retry_count` сек).
  - Если число попыток превысило максимум — ставит статус `failed`.

- **Event-driven оповещение:**
  - Воркеры отправляют сообщения в `broadcast::Sender`.
  - Клиенты подписываются на SSE-события и получают уведомления о статусах сообщений в реальном времени.
